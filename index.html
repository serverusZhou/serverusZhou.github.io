<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Browser behavior detection</title>
    </head>
    <body>
        <p>Browser agent: <span id="browserAgent"></span></p>

        <p>Third Browser: <span id="isThirdBrowser"></span></p>
        <img src="/teamgroup.png" style="max-width: 100%;" onload="generateUrl" id="generateUrlImage" />
        <p>
            <a href="/manual.docx" download>Download a docx</a>
        </p>
        <p>
            <a href="/teamgroup.png" download>Download Image Through Direct URL</a>
        </p>
        <p>
            <a id="base64">Download Image Through Base64 Code</a>
        </p>
        <p>
            <a id= 'blob' download>Download Image Through Blob Url</a>
        </p>
        <p id="error" style="color: red;"></p>
        <script type="text/javascript">
            document.getElementById('browserAgent').innerHTML = navigator.userAgent.toLowerCase();
    
            document.getElementById('isThirdBrowser').innerHTML = navigator.appVersion.match(/(?:Version\/)([\w_]+)/);
    
            // document.getElementById('download').innerHTML =  'download' in document.createElement('a');
    
            window.onerror = function(message) {
                document.getElementById('error').append(message + '\n');
            }

            function generateUrl(e) {
                const canvas = document.createElement('canvas');
                const image = e.target;
                const ctx = canvas.getContext('2d');

                const imagePositionX = image.x || 0;
                const imagePositionY = image.y || 0;
                const imageWidth = image.width;
                const imageHeight = image.height;

                ctx.drawImage(image, imagePositionX, imagePositionY, imageWidth, imageHeight);

                console.log('canvas.toDataURL()', canvas.toDataURL());

                document.getElementById('base64').href = canvas.toDataURL();

                canvas.toBlob(blob => {
                    document.getElementById('blob').href = URL.createObjectURL(blob);
                });
            }

            setTimeout(() => {
                generateUrl({ target: document.getElementById('generateUrlImage')});
            }, 500);
        </script>
    </body>
</html>
